---
- name: Bootstrap Python
  hosts: all
  gather_facts: false
  tasks:
    - name: Install Python via raw (no Python needed)
      ansible.builtin.raw: DEBIAN_FRONTEND=noninteractive apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y python3
      changed_when: true

- name: Prepare
  hosts: all
  environment:
    DEBIAN_FRONTEND: noninteractive
  tasks:
    - name: Install prerequisites
      ansible.builtin.apt:
        name:
          - sudo
          - tar
          - gzip
          - xz-utils
          - unzip
          - ca-certificates
          - curl
          - libfuse2
          - build-essential
          - libclang-dev
        state: present
        update_cache: true

    - name: Create test user
      ansible.builtin.user:
        name: testuser
        create_home: true
        shell: /bin/bash

    - name: Create bin directory
      ansible.builtin.file:
        path: /home/testuser/bin
        state: directory
        owner: testuser
        group: testuser
        mode: "0755"

    - name: Create .usr/local directory
      ansible.builtin.file:
        path: /home/testuser/.usr/local
        state: directory
        owner: testuser
        group: testuser
        mode: "0755"
