
playbook to get my local dev enviroment up and running.

This currently assumes admin permissions are availabe. Will, install python,
postgres, postgis, neovim general tools

Ansible Setup
-------------

sudo apt-get install python3.10-minimal python3.10-venv
python3.10 -m venv ~/.venv/ansible
. ~/.venv/ansible/bin/activate


Basic Use
---------

eval `ssh-agent`
ssh-add
# export PATH=~/.local/bin:$PATH
pip install ansible
ansible-galaxy install -r requirements.yml
ansible-playbook --ask-become-pass playbook.yml --tags=basic,email --ask-vault-pass -v


Linting
-------

pip install ansible-lint yamllint

yamllint .
ansible-lint


Testing
-------

pip install 'molecule[docker]'

Run the full test suite for the software-local role (requires Docker):

    cd roles/software-local
    molecule test

This runs: create container, prepare, converge, idempotence check, verify, destroy.

Individual steps for development:

    molecule converge   # just run the role
    molecule verify     # just run verification
    molecule login      # shell into the container
    molecule destroy    # tear down

Note: each full run hits the GitHub API 9+ times and downloads ~200MB of
binaries, so it takes a while.



GitHub Version Caching
----------------------

The software-local role fetches latest release versions from the GitHub API for
tools like ripgrep, fzf, neovim, etc. To avoid repeated API calls (and GitHub's
60 requests/hour rate limit for unauthenticated requests), versions are cached
in ~/.cache/ansible-versions/ for 24 hours.

On the first run, each tool queries GitHub and writes the version to a cache
file. Subsequent runs within 24 hours read from cache instead. After 24 hours
the cache is considered stale and GitHub is queried again.

To force a fresh lookup for a specific tool:

    rm ~/.cache/ansible-versions/ripgrep

To clear all cached versions:

    rm -rf ~/.cache/ansible-versions/


TODO:
Ruby and Rails stuff


For email:


Manual Steps.

Login to keybase:

keybase login

Import gpg key:
keybase pgp export | gpg --import

gpg -k

gpg --edit-key Your-Key-ID-Here
gpg> passwd
gpg> save
